<?php


    if (is_array($_POST['products1'])) {
        $selected = '';
        $num_countries = count($_POST['products1']);
        $current = 0;
        foreach ($_POST['products1'] as $key => $value) {
            if ($current%2!=0) 
				$selected .= $value.'<br>';
			else //Sino
				$selected .= $value.'';
			$current++;
        }
    }
    if (is_array($_POST['products2'])) {
        $selected2 = '';
        $num_countries2 = count($_POST['products2']);
        $current2 = 0;
        foreach ($_POST['products2'] as $key2 => $value2) {
            if ($current2%2!=0) 
				$selected2 .= $value2.'<br>';
			else //Sino
				$selected2 .= $value2.'';
			$current2++;
        }
    }
    if (is_array($_POST['products3'])) {
        $selected3 = '';
        $num_countries3 = count($_POST['products3']);
        $current3 = 0;
        foreach ($_POST['products3'] as $key3 => $value3) {
            if ($current3%2!=0) 
				$selected3 .= $value3.'<br>';
			else //Sino
				$selected3 .= $value3.'';
			$current3++;
        }
    }
    if (is_array($_POST['products4'])) {
        $selected4 = '';
        $num_countries4 = count($_POST['products4']);
        $current4 = 0;
        foreach ($_POST['products4'] as $key4 => $value4) {
            if ($current4%2!=0) 
                $selected4 .= $value4.'<br>';
            else //Sino
                $selected4 .= $value4.'';
            $current4++;
        }
    }
    if (is_array($_POST['products5'])) {
        $selected5 = '';
        $num_countries5 = count($_POST['products5']);
        $current5 = 0;
        foreach ($_POST['products5'] as $key5 => $value5) {
            if ($current5%2!=0) 
                $selected5 .= $value5.'<br>';
            else //Sino
                $selected5 .= $value5.'';
            $current5++;
        }
    }
    if (is_array($_POST['products6'])) {
        $selected6 = '';
        $num_countries6 = count($_POST['products6']);
        $current6 = 0;
        foreach ($_POST['products6'] as $key6 => $value6) {
            if ($current6%2!=0) 
                $selected6 .= $value6.'<br>';
            else //Sino
                $selected6 .= $value6.'';
            $current6++;
        }
    }
    if (is_array($_POST['products7'])) {
        $selected7 = '';
        $num_countries7 = count($_POST['products7']);
        $current7 = 0;
        foreach ($_POST['products7'] as $key7 => $value7) {
            if ($current7%2!=0) 
                $selected7 .= $value7.'<br>';
            else //Sino
                $selected7 .= $value7.'';
            $current7++;
        }
    }
    if (is_array($_POST['products8'])) {
        $selected8 = '';
        $num_countries8 = count($_POST['products8']);
        $current8 = 0;
        foreach ($_POST['products8'] as $key8 => $value8) {
            if ($current8%2!=0) 
                $selected8 .= $value8.'<br>';
            else //Sino
                $selected8 .= $value8.'';
            $current8++;
        }
    }
    if (is_array($_POST['products9'])) {
        $selected9 = '';
        $num_countries9 = count($_POST['products9']);
        $current9 = 0;
        foreach ($_POST['products9'] as $key9 => $value9) {
            if ($current9%2!=0) 
                $selected9 .= $value9.'<br>';
            else //Sino
                $selected9 .= $value9.'';
            $current9++;
        }
    }
    if (is_array($_POST['products10'])) {
        $selected10 = '';
        $num_countries10 = count($_POST['products10']);
        $current10 = 0;
        foreach ($_POST['products10'] as $key10 => $value10) {
            if ($current10%2!=0) 
                $selected10 .= $value10.'<br>';
            else //Sino
                $selected10 .= $value10.'';
            $current10++;
        }
    }
    if (is_array($_POST['products11'])) {
        $selected11 = '';
        $num_countries11 = count($_POST['products11']);
        $current11 = 0;
        foreach ($_POST['products11'] as $key11 => $value11) {
            if ($current11%2!=0) 
                $selected11 .= $value11.'<br>';
            else //Sino
                $selected11 .= $value11.'';
            $current11++;
        }
    }
    if (is_array($_POST['products12'])) {
        $selected12 = '';
        $num_countries12 = count($_POST['products12']);
        $current12 = 0;
        foreach ($_POST['products12'] as $key12 => $value12) {
            if ($current12%2!=0) 
                $selected12 .= $value12.'<br>';
            else //Sino
                $selected12 .= $value12.'';
            $current12++;
        }
    }
    if (is_array($_POST['products13'])) {
        $selected13 = '';
        $num_countries13 = count($_POST['products13']);
        $current13 = 0;
        foreach ($_POST['products13'] as $key13 => $value13) {
            if ($current13%2!=0) 
                $selected13 .= $value13.'<br>';
            else //Sino
                $selected13 .= $value13.'';
            $current13++;
        }
    }
    if (is_array($_POST['products14'])) {
        $selected14 = '';
        $num_countries14 = count($_POST['products14']);
        $current14 = 0;
        foreach ($_POST['products14'] as $key14 => $value14) {
            if ($current14%2!=0) 
                $selected14 .= $value14.'<br>';
            else //Sino
                $selected14 .= $value14.'';
            $current14++;
        }
    }
    if (is_array($_POST['products15'])) {
        $selected15 = '';
        $num_countries15 = count($_POST['products15']);
        $current15 = 0;
        foreach ($_POST['products15'] as $key15 => $value15) {
            if ($current15%2!=0) 
                $selected15 .= $value15.'<br>';
            else //Sino
                $selected15 .= $value15.'';
            $current15++;
        }
    }
    if (is_array($_POST['products16'])) {
        $selected16 = '';
        $num_countries16 = count($_POST['products16']);
        $current16 = 0;
        foreach ($_POST['products16'] as $key16 => $value16) {
            if ($current16%2!=0) 
                $selected16 .= $value16.'<br>';
            else //Sino
                $selected16 .= $value16.'';
            $current16++;
        }
    }
    if (is_array($_POST['products17'])) {
        $selected17 = '';
        $num_countries17 = count($_POST['products17']);
        $current17 = 0;
        foreach ($_POST['products17'] as $key17 => $value17) {
            if ($current17%2!=0) 
                $selected17 .= $value17.'<br>';
            else //Sino
                $selected17 .= $value17.'';
            $current17++;
        }
    }
    if (is_array($_POST['products18'])) {
        $selected18 = '';
        $num_countries18 = count($_POST['products18']);
        $current18 = 0;
        foreach ($_POST['products18'] as $key18 => $value18) {
            if ($current18%2!=0) 
                $selected18 .= $value18.'<br>';
            else //Sino
                $selected18 .= $value18.'';
            $current18++;
        }
    }
    if (is_array($_POST['products19'])) {
        $selected19 = '';
        $num_countries19 = count($_POST['products19']);
        $current19 = 0;
        foreach ($_POST['products19'] as $key19 => $value19) {
            if ($current19%2!=0) 
                $selected19 .= $value19.'<br>';
            else //Sino
                $selected19 .= $value19.'';
            $current19++;
        }
    }
    if (is_array($_POST['products20'])) {
        $selected20 = '';
        $num_countries20 = count($_POST['products20']);
        $current20 = 0;
        foreach ($_POST['products20'] as $key20 => $value20) {
            if ($current20%2!=0) 
                $selected20 .= $value20.'<br>';
            else //Sino
                $selected20 .= $value20.'';
            $current20++;
        }
    }
    if (is_array($_POST['products21'])) {
        $selected21 = '';
        $num_countries21 = count($_POST['products21']);
        $current21 = 0;
        foreach ($_POST['products21'] as $key21 => $value21) {
            if ($current21%2!=0) 
                $selected21 .= $value21.'<br>';
            else //Sino
                $selected21 .= $value21.'';
            $current21++;
        }
    }
    if (is_array($_POST['products22'])) {
        $selected22 = '';
        $num_countries22 = count($_POST['products22']);
        $current22 = 0;
        foreach ($_POST['products22'] as $key22 => $value22) {
            if ($current22%2!=0) 
                $selected22 .= $value22.'<br>';
            else //Sino
                $selected22 .= $value22.'';
            $current22++;
        }
    }
    if (is_array($_POST['products23'])) {
        $selected23 = '';
        $num_countries23 = count($_POST['products23']);
        $current23 = 0;
        foreach ($_POST['products23'] as $key23 => $value23) {
            if ($current23%2!=0) 
                $selected23 .= $value23.'<br>';
            else //Sino
                $selected23 .= $value23.'';
            $current23++;
        }
    }
    if (is_array($_POST['products24'])) {
        $selected24 = '';
        $num_countries24 = count($_POST['products24']);
        $current24 = 0;
        foreach ($_POST['products24'] as $key24 => $value24) {
            if ($current24%2!=0) 
                $selected24 .= $value24.'<br>';
            else //Sino
                $selected24 .= $value24.'';
            $current24++;
        }
    }
    if (is_array($_POST['products25'])) {
        $selected25 = '';
        $num_countries25 = count($_POST['products25']);
        $current25 = 0;
        foreach ($_POST['products25'] as $key25 => $value25) {
            if ($current25%2!=0) 
                $selected25 .= $value25.'<br>';
            else //Sino
                $selected25 .= $value25.'';
            $current25++;
        }
    }
    if (is_array($_POST['products26'])) {
        $selected26 = '';
        $num_countries26 = count($_POST['products26']);
        $current26 = 0;
        foreach ($_POST['products26'] as $key26 => $value26) {
            if ($current26%2!=0) 
                $selected26 .= $value26.'<br>';
            else //Sino
                $selected26 .= $value26.'';
            $current26++;
        }
    }

    if ($current == 1) {

    }else{
    	$text= "<br><font color='#0a7c98'><strong>FRESH VEGETABLES</font>:</strong> <br>".$selected."<br>";
    }

    if ($current2 == 1) {

    }else{
    	$text2= "<br><font color='#0a7c98'><strong>FRESH FRUITS</font>:</strong> <br>".$selected2."<br>";
    }

    if ($current3 == 1) {

    }else{
    	$text3= "<br><font color='#0a7c98'><strong>REFRIGERATED ITEMS</font>:</strong> <br>".$selected3."<br>";
    }

    if ($current4 == 1) {

    }else{
    	$text4= "<br><font color='#0a7c98'><strong>FROZEN</font>:</strong> <br>".$selected4."<br>";
    }

    if ($current5 == 1) {

    }else{
    	$text5= "<br><font color='#0a7c98'><strong>CONDIMENTS / SAUCES</font>:</strong> <br>".$selected5."<br>";
    }

    if ($current6 == 1) {

    }else{
    	$text6= "<br><font color='#0a7c98'><strong>VARIOUS GROCERIES</font>:</strong> <br>".$selected6."<br>";
    }

    if ($current7 == 1) {

    }else{
    	$text7= "<br><font color='#0a7c98'><strong>CANNED FOODS</font>:</strong> <br>".$selected7."<br>";
    }

    if ($current8 == 1) {

    }else{
    	$text8= "<br><font color='#0a7c98'><strong>SPICES & HERBS</font>:</strong> <br>".$selected8."<br>";
    }

    if ($current9 == 1) {

    }else{
    	$text9= "<br><font color='#0a7c98'><strong>DAIRY</font>:</strong> <br>".$selected9."<br>";
    }

    if ($current10 == 1) {

    }else{
    	$text10= "<br><font color='#0a7c98'><strong>CHEESE</font>:</strong> <br>".$selected10."<br>";
    }

    if ($current11 == 1) {

    }else{
    	$text11= "<br><font color='#0a7c98'><strong>MEAT</font>:</strong> <br>".$selected11."<br>";
    }

    if ($current12 == 1) {

    }else{
    	$text12= "<br><font color='#0a7c98'><strong>SEAFOOD</font>:</strong> <br>".$selected12."<br>";
    }

    if ($current13 == 1) {

    }else{
    	$text13= "<br><font color='#0a7c98'><strong>BEVERAGES</font>:</strong> <br>".$selected13."<br>";
    }

    if ($current14 == 1) {

    }else{
    	$text14= "<br><font color='#0a7c98'><strong>BAKED GOODS</font>:</strong> <br>".$selected14."<br>";
    }

    if ($current15 == 1) {

    }else{
    	$text15= "<br><font color='#0a7c98'><strong>BAKING</font>:</strong> <br>".$selected15."<br>";
    }

    if ($current16 == 1) {

    }else{
    	$text16= "<br><font color='#0a7c98'><strong>SNACKS</font>:</strong> <br>".$selected16."<br>";
    }

    if ($current17 == 1) {

    }else{
    	$text17= "<br><font color='#0a7c98'><strong>THEMED MEALS</font>:</strong> <br>".$selected17."<br>";
    }

    if ($current18 == 1) {

    }else{
    	$text18= "<br><font color='#0a7c98'><strong>BABY STUF</font>:</strong> <br>".$selected18."<br>";
    }

    if ($current19 == 1) {

    }else{
    	$text19= "<br><font color='#0a7c98'><strong>PETS</font>:</strong> <br>".$selected19."<br>";
    }

    if ($current20 == 1) {

    }else{
    	$text20= "<br><font color='#0a7c98'><strong>PERSONAL CARE</font>:</strong> <br>".$selected20."<br>";
    }

    if ($current21 == 1) {

    }else{
    	$text21= "<br><font color='#0a7c98'><strong>MEDICINE</font>:</strong> <br>".$selected21."<br>";
    }

    if ($current22 == 1) {

    }else{
    	$text22= "<br><font color='#0a7c98'><strong>KITCHEN</font>:</strong> <br>".$selected22."<br>";
    }

    if ($current23 == 1) {

    }else{
    	$text23= "<br><font color='#0a7c98'><strong>CLEANING PRODUCTS</font>:</strong> <br>".$selected23."<br>";
    }

    if ($current24 == 1) {

    }else{
    	$text24= "<br><font color='#0a7c98'><strong>OFFICE SUPPLIES</font>:</strong> <br>".$selected24."<br>";
    }

    if ($current25 == 1) {

    }else{
    	$text25= "<br><font color='#0a7c98'><strong>OTHER STUF</font>:</strong> <br>".$selected25."<br>";
    }

    if ($current26 == 1) {

    }else{
    	$text26= "<br><font color='#0a7c98'><strong>CARCINOGENS</font>:</strong> <br>".$selected26."<br>";
    }
    
    $another = $_POST['products27'];
    $texto27 = strlen($another);

    if ($texto27 == 0) {
    	# code...
    }else{
    	$text27 = "<br><font color='#0a7c98'><strong>Another Products</font>:</strong> <br>".$another;
    }

    $name = "<br><font color='#0a7c98'><strong>Name</font>:</strong> ".$_POST['name'];
    $property = "<br><font color='#0a7c98'><strong>Property</font>:</strong> ".$_POST['property'];
    $phone = "<br><font color='#0a7c98'><strong>Telephone #</font>:</strong> ".$_POST['phone'];
    $date = "<br><font color='#0a7c98'><strong>Date and Time of Arrival</font>:</strong> ".$_POST['date'];
    $brand = "<br><font color='#0a7c98'><strong>Would you like us to substitute it with a similar brand?</font>:</strong> ".$_POST['brand'];
    $gratuity = "<br><font color='#0a7c98'><strong>Add a 15%  gratuity for grocery stocking? </font>:</strong> ".$_POST['gratuity']."<br>";
    $email_send = $_POST['email'];

require("fpdf.php");
require("phpmailer/PHPMailerAutoload.php");


function hex2dec($couleur = "#000000"){
    $R = substr($couleur, 1, 2);
    $rouge = hexdec($R);
    $V = substr($couleur, 3, 2);
    $vert = hexdec($V);
    $B = substr($couleur, 5, 2);
    $bleu = hexdec($B);
    $tbl_couleur = array();
    $tbl_couleur['R']=$rouge;
    $tbl_couleur['V']=$vert;
    $tbl_couleur['B']=$bleu;
    return $tbl_couleur;
}

function px2mm($px){
    return $px*25.4/72;
}

function txtentities($html){
    $trans = get_html_translation_table(HTML_ENTITIES);
    $trans = array_flip($trans);
    return strtr($html, $trans);
}

class PDF_HTML extends FPDF
{
	//variables of html parser
	protected $B;
	protected $I;
	protected $U;
	protected $HREF;
	protected $fontList;
	protected $issetfont;
	protected $issetcolor;

	function Header()
	{
		$this->Image('images/logo.png',5,5,30,20);
		$this->Image('images/check-images/groceries.png',100,50,40,40);
		$this->SetFont('Arial','',12);
		$this->Ln(3);
		$this->Cell(0,0,'Delivery List',0,1,'C');
		$this->Ln(18);
	}

	function __construct($orientation='P', $unit='mm', $format='A4')
	{
	    //Call parent constructor
	    parent::__construct($orientation,$unit,$format);
	    //Initialization
	    $this->B=0;
	    $this->I=0;
	    $this->U=0;
	    $this->HREF='';
	    $this->fontlist=array('arial', 'times', 'courier', 'helvetica', 'symbol');
	    $this->issetfont=false;
	    $this->issetcolor=false;
	}

	function WriteHTML($html)
	{
	    //HTML parser
	    $html=strip_tags($html,"<b><u><i><a><img><p><br><strong><em><font><tr><blockquote>"); //supprime tous les tags sauf ceux reconnus
	    $html=str_replace("\n",' ',$html); //remplace retour à la ligne par un espace
	    $a=preg_split('/<(.*)>/U',$html,-1,PREG_SPLIT_DELIM_CAPTURE); //éclate la chaîne avec les balises
	    foreach($a as $i=>$e)
	    {
	        if($i%2==0)
	        {
	            //Text
	            if($this->HREF)
	                $this->PutLink($this->HREF,$e);
	            else
	                $this->Write(5,stripslashes(txtentities($e)));
	        }
	        else
	        {
	            //Tag
	            if($e[0]=='/')
	                $this->CloseTag(strtoupper(substr($e,1)));
	            else
	            {
	                //Extract attributes
	                $a2=explode(' ',$e);
	                $tag=strtoupper(array_shift($a2));
	                $attr=array();
	                foreach($a2 as $v)
	                {
	                    if(preg_match('/([^=]*)=["\']?([^"\']*)/',$v,$a3))
	                        $attr[strtoupper($a3[1])]=$a3[2];
	                }
	                $this->OpenTag($tag,$attr);
	            }
	        }
	    }
	}

	function OpenTag($tag, $attr)
	{
	    //Opening tag
	    switch($tag){
	        case 'STRONG':
	            $this->SetStyle('B',true);
	            break;
	        case 'EM':
	            $this->SetStyle('I',true);
	            break;
	        case 'B':
	        case 'I':
	        case 'U':
	            $this->SetStyle($tag,true);
	            break;
	        case 'A':
	            $this->HREF=$attr['HREF'];
	            break;
	        case 'IMG':
	            if(isset($attr['SRC']) && (isset($attr['WIDTH']) || isset($attr['HEIGHT']))) {
	                if(!isset($attr['WIDTH']))
	                    $attr['WIDTH'] = 0;
	                if(!isset($attr['HEIGHT']))
	                    $attr['HEIGHT'] = 0;
	                $this->Image($attr['SRC'], $this->GetX(), $this->GetY(), px2mm($attr['WIDTH']), px2mm($attr['HEIGHT']));
	            }
	            break;
	        case 'TR':
	        case 'BLOCKQUOTE':
	        case 'BR':
	            $this->Ln(5);
	            break;
	        case 'P':
	            $this->Ln(10);
	            break;
	        case 'FONT':
	            if (isset($attr['COLOR']) && $attr['COLOR']!='') {
	                $coul=hex2dec($attr['COLOR']);
	                $this->SetTextColor($coul['R'],$coul['V'],$coul['B']);
	                $this->issetcolor=true;
	            }
	            if (isset($attr['FACE']) && in_array(strtolower($attr['FACE']), $this->fontlist)) {
	                $this->SetFont(strtolower($attr['FACE']));
	                $this->issetfont=true;
	            }
	            break;
	    }
	}

	function CloseTag($tag)
	{
	    //Closing tag
	    if($tag=='STRONG')
	        $tag='B';
	    if($tag=='EM')
	        $tag='I';
	    if($tag=='B' || $tag=='I' || $tag=='U')
	        $this->SetStyle($tag,false);
	    if($tag=='A')
	        $this->HREF='';
	    if($tag=='FONT'){
	        if ($this->issetcolor==true) {
	            $this->SetTextColor(0);
	        }
	        if ($this->issetfont) {
	            $this->SetFont('arial');
	            $this->issetfont=false;
	        }
	    }
	}

	function SetStyle($tag, $enable)
	{
	    //Modify style and select corresponding font
	    $this->$tag+=($enable ? 1 : -1);
	    $style='';
	    foreach(array('B','I','U') as $s)
	    {
	        if($this->$s>0)
	            $style.=$s;
	    }
	    $this->SetFont('',$style);
	}

	function PutLink($URL, $txt)
	{
    //Put a hyperlink
    $this->SetTextColor(0,0,255);
    $this->SetStyle('U',true);
    $this->Write(5,$txt,$URL);
    $this->SetStyle('U',false);
    $this->SetTextColor(0);
}

}//end of class

	$pd=new PDF_HTML();
	$pd->AddPage();
	$pd->AliasNbPages();
	$pd->SetAutoPageBreak(true,2);
	$pd->SetFont('Arial');
	$pd->WriteHTML(utf8_decode($name));
    $pd->WriteHTML(utf8_decode($property));
    $pd->WriteHTML(utf8_decode($phone));
    $pd->WriteHTML(utf8_decode($date));
    $pd->WriteHTML(utf8_decode($brand));
    $pd->WriteHTML(utf8_decode($gratuity));
    $pd->WriteHTML(utf8_decode($text));
    $pd->WriteHTML(utf8_decode($text2));
    $pd->WriteHTML(utf8_decode($text3));
    $pd->WriteHTML(utf8_decode($text4));
    $pd->WriteHTML(utf8_decode($text5));
    $pd->WriteHTML(utf8_decode($text6));
    $pd->WriteHTML(utf8_decode($text7));
    $pd->WriteHTML(utf8_decode($text8));
    $pd->WriteHTML(utf8_decode($text9));
    $pd->WriteHTML(utf8_decode($text10));
    $pd->WriteHTML(utf8_decode($text11));
    $pd->WriteHTML(utf8_decode($text12));
    $pd->WriteHTML(utf8_decode($text13));
    $pd->WriteHTML(utf8_decode($text14));
    $pd->WriteHTML(utf8_decode($text15));
    $pd->WriteHTML(utf8_decode($text16));
    $pd->WriteHTML(utf8_decode($text17));
    $pd->WriteHTML(utf8_decode($text18));
    $pd->WriteHTML(utf8_decode($text19));
    $pd->WriteHTML(utf8_decode($text20));
    $pd->WriteHTML(utf8_decode($text21));
    $pd->WriteHTML(utf8_decode($text22));
    $pd->WriteHTML(utf8_decode($text23));
    $pd->WriteHTML(utf8_decode($text24));
    $pd->WriteHTML(utf8_decode($text25));
    $pd->WriteHTML(utf8_decode($text26));
    $pd->WriteHTML(utf8_decode($text27));

	$pd->Output($archivo,"f");

	$pd->Output($archivo,"doc.pdf");
	$archivos="doc.pdf";


$mail = new PHPMailer;

$mail->addAddress($email_send, 'Contact Client');
//Set who the message is to be sent from
$mail->setFrom('athoma@techdev.mx', 'Contact Vail Butler');
//Set an alternative reply-to address
$mail->addReplyTo('replyto@example.com', 'Contact Vail Butler');
//Set who the message is to be sent to
$mail->addAddress('thomabaker12@gmail.com', 'Vail Butler');
//Set the subject line
$mail->Subject = 'Request from Web Contact';
//Read an HTML message body from an external file, convert referenced images to embedded,
//convert HTML into a basic plain-text alternative body
$mail->msgHTML("The User ".$_POST['name']." with the mail: ".$email_send." has made the following order from the web contact");
//Replace the plain text body with one created manually
$mail->AltBody = 'This is a plain-text message body';
//Attach an image file
$mail->addAttachment('doc.pdf');
//send the message, check for errors
if (!$mail->send()) {
    echo "Mailer Error: " . $mail->ErrorInfo;
} else {
    echo "Message sent!";
}

?>